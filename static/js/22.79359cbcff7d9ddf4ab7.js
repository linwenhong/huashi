webpackJsonp([22],{"714R":function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=o("BHhu"),i=o("8IWg"),a=o("+0rj"),n=o("9+VK"),r=o("TNi3"),c=o("BXxX"),l={name:"scoreDetails",data:function(){return{id:this.$route.params.id,form:{},dataKeys:i.J,proportions:{},proportionsData:{},isChange:!1,proportionsSum:100,canSubmit:!0,isDisabled:!0,api_url:s.a,count:0}},methods:{fileChange:function(t){$("#"+t).get(0).files[0]&&(this.form[t]=$("#"+t).get(0).files[0],this.count++)},scoreChange:function(t){this.form[t]=Number(this.form[t]).toFixed(0)},proportionChange:function(t){this.proportions[t]=Number(this.proportions[t]).toFixed(0);var e=0;for(var o in this.proportions)e+=Number(this.proportions[o]);this.proportionsSum=e,this.isChange=!0},submit:function(){var t=this;if(this.isChange){if(100!=this.proportionsSum)return void toastr.warning("比例总和必须为100");var e={};for(var o in this.proportions){if(Number(this.proportions[o])<0)return void toastr.warning("比例不能为负数");"total"!=o&&"annex"!=o&&"remark"!=o&&(e[o]=Number(this.proportions[o])/100)}c.a.Proportion.edit(this.proportionsData.id,e).then(function(e){200==e.code&&a.a.getFormVal(t.dataKeys,t.form).then(function(e){return t.confirm(e)})})}else a.a.getFormVal(this.dataKeys,this.form).then(function(e){return t.confirm(e)})},confirm:function(t){var e=this;this.canSubmit=!1,"new"!=this.id?c.a.Score.edit(this.id,t).then(function(t){return e.responseHandle(t)}):c.a.Score.add(t).then(function(t){return e.responseHandle(t)})},responseHandle:function(t){200==t.code?(toastr.success(t.msg),setTimeout(function(){return a.a.tabReload(210)},1e3)):(toastr.error(t.msg),this.canSubmit=!0)},cancel:function(){r.a.closeNowTab()}},created:function(){var t=this;n.a.hasPermission("score")&&(this.isDisabled=!1),c.a.Proportion.get().then(function(e){200==e.code&&(t.proportionsData=e.data,t.proportions={},t.dataKeys.map(function(o,s){s>2&&(t.proportions[o.key]=e.data[o.key]?100*e.data[o.key]:0)}))}),"new"!=this.id&&c.a.Score.details(this.id).then(function(e){200==e.code&&(t.form=e.data,$("#time").val(e.data.time))})},mounted:function(){}},u={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"wrapper wrapper-content"},[o("div",{staticClass:"ibox"},[t._m(0),t._v(" "),o("div",{staticClass:"ibox-content"},[o("form",{staticClass:"form-horizontal",on:{submit:function(e){return e.preventDefault(),t.submit(e)}}},[o("div",{staticClass:"row"},[t._l(t.dataKeys,function(e,s){return e.isHide?t._e():[e.isRemark?[o("div",{staticClass:"floor"},[o("label",{staticClass:"col-sm-2 control-label"},[e.isMust?o("span",{staticClass:"MustFill"},[t._v("*")]):t._e(),t._v(t._s(e.name))]),t._v(" "),o("div",{staticClass:"col-sm-8 right"},[o("textarea",{directives:[{name:"model",rawName:"v-model",value:t.form[e.key],expression:"form[option.key]"}],staticClass:"form-control",attrs:{maxlength:"1000"},domProps:{value:t.form[e.key]},on:{input:function(o){o.target.composing||t.$set(t.form,e.key,o.target.value)}}})])])]:[o("div",{staticClass:"col-sm-6"},[o("div",{staticClass:"form-group"},[o("label",{staticClass:"col-sm-4 control-label"},[e.isMust?o("span",{staticClass:"MustFill"},[t._v("*")]):t._e(),t._v(t._s(e.name)+"：")]),t._v(" "),o("div",{staticClass:"col-sm-8 right"},[e.isDateTime?[o("input",{staticClass:"form-control layer-date",attrs:{readonly:"",id:"time",placeholder:"请选择日期",onclick:"laydate({ elem: '#time'})"}})]:e.isFile?[t._m(1,!0),t._v(" "),o("input",{staticClass:"file",attrs:{id:e.key,type:"file"},on:{change:function(o){t.fileChange(e.key)}}}),t._v(" "),o("span",{staticClass:"remark"},[t._v("(最大20M)")]),t._v("\n                      "+t._s(t.form[e.key]&&t.form[e.key].name?t.form[e.key].name:t.form[e.key]?t.api_url+t.form[e.key]:"")+"\n                    ")]:[s<=2?o("input",{directives:[{name:"model",rawName:"v-model",value:t.form[e.key],expression:"form[option.key]"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:t.form[e.key]},on:{input:function(o){o.target.composing||t.$set(t.form,e.key,o.target.value)}}}):t._e(),t._v(" "),s>2?[o("input",{directives:[{name:"model",rawName:"v-model",value:t.form[e.key],expression:"form[option.key]"}],staticClass:"form-control proportion",attrs:{onkeyup:"this.value=this.value.replace(/[^0-9]/g,'')"},domProps:{value:t.form[e.key]},on:{change:function(o){t.scoreChange(e.key)},input:function(o){o.target.composing||t.$set(t.form,e.key,o.target.value)}}}),t._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:t.proportions[e.key],expression:"proportions[option.key]"}],staticClass:"form-control proportion",attrs:{onkeyup:"this.value=this.value.replace(/[^0-9]/g,'')"},domProps:{value:t.proportions[e.key]},on:{change:function(o){t.proportionChange(e.key)},input:function(o){o.target.composing||t.$set(t.proportions,e.key,o.target.value)}}}),t._v(" %\n                      ")]:t._e()]],2)])])]]})],2),t._v(" "),100!=t.proportionsSum?o("p",[t._v("比例总和必须为100%, 目前比例总和为"+t._s(t.proportionsSum)+"%")]):t._e(),t._v(" "),o("div",{staticClass:"text-center row"},[t.isDisabled?t._e():[t.canSubmit?o("button",{staticClass:"btn btn-primary",attrs:{type:"submit"}},[t._v("保存")]):t._e(),t._v(" "),t.canSubmit?t._e():o("button",{staticClass:"btn btn-default"},[t._v("保存")])],t._v(" "),o("b",{staticClass:"btn btn-white",on:{click:t.cancel}},[t._v("取消")])],2)])])]),t._v(" "),o("div",{staticStyle:{display:"none"}},[t._v(t._s(t.count))])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"ibox-title"},[e("h5",[this._v("评分")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("button",{staticClass:"btn btn-sm btn-primary",attrs:{type:"button"}},[e("i",{staticClass:"fa fa-upload"}),this._v("  \n                        "),e("span",{staticClass:"bold"},[this._v("选择附件")])])}]};var m=o("VU/8")(l,u,!1,function(t){o("dyTx")},"data-v-8bf151d4",null);e.default=m.exports},dyTx:function(t,e){}});
//# sourceMappingURL=22.79359cbcff7d9ddf4ab7.js.map