webpackJsonp([80],{3031:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});a("BHhu"),a("8IWg"),a("TNi3"),a("jNku"),a("+0rj");var i=a("9+VK"),s=a("BXxX"),n={name:"annualBriefing",data:function(){return{state:0,chartList:[{elmId:"chart-1",title:"论文发表情况 - 中文",key:"journal_chinese_paper",selectName:"中文论文"},{elmId:"chart-2",title:"论文发表情况 - 英文",key:"journal_english_paper",selectName:"英文论文"},{elmId:"chart-3",title:"获批项目经费",key:"funds_of_res_pro",selectName:"获批项目经费"},{elmId:"chart-8",title:"获批项目数量",key:"num_of_res_pro",selectName:"获批项目数量"},{elmId:"chart-4",title:"科研获奖 - 国家级项目",key:"num_of_res_awa_cou",selectName:"国家级项目"},{elmId:"chart-5",title:"科研获奖 - 省级项目",key:"num_of_res_awa_province",selectName:"省级项目"},{elmId:"chart-6",title:"科研获奖 - 部级项目",key:"num_of_res_awa_min",selectName:"部级项目"},{elmId:"chart-7",title:"科研获奖 - 全部项目",key:"num_of_res_awa",selectName:"全部项目"}],condition:{},searchOptions:[{label:"时间",key:"time",type:"date"},{label:"名称",key:"name"}],model:"",selectOption:[],canExport:i.a.hasPermission("management_work")}},methods:{getData:function(){var t=this,e={};for(var a in this.condition)e[a]=this.condition[a];s.a.StatisticsChart.get(e).then(function(e){200==e.code&&t.chartList.map(function(a){var i=e.data[a.key];i.elmId=a.elmId,t.setChart(i)})})},publicSearch:function(t){for(var e in this.condition={},t)t[e]&&(this.condition[e]=t[e]);this.getData()},selectTag:function(t){t!=this.state&&(this.setChartOptions(t),this.state=t)},setChartOptions:function(t){if(t>0)switch(Number(t)){case 1:this.selectOption=["中文论文","英文论文"];break;case 2:this.selectOption=["获批项目经费","获批项目数量"];break;case 3:this.selectOption=["国家级项目","省级项目","部级项目","全部项目"]}else this.selectOption=[]},canShow:function(t){if(0==this.state)return!0;if(""==this.model){if($.inArray(t.selectName,this.selectOption)>-1)return!0}else if(t.selectName==this.model)return!0;return!1},savePDF:function(){$(".super").remove();var t=$("#chartBox"),e=$("<div/>");e.addClass("super"),e.width(t.width()+"px"),e.height(t.height()+"px"),$("body").append(e),html2canvas($("#chartBox"),{allowTaint:!0,height:$("#chartBox").outerHeight(),background:"#ffffff",onrendered:function(t){var e=t.width,a=t.height,i=e/592.28*841.89,s=a,n=0,c=595.28,o=592.28/e*a;$('.chart[style="display: none;"]').length==$(".chart").length-1&&(c*=2,o*=2),c*=.84,o*=.84;var r=t.toDataURL("image/jpeg",1),l=new jsPDF("","pt","a4");if(s<i)l.addImage(r,"JPEG",20,20,c,o);else for(;s>0;)l.addImage(r,"JPEG",20,n,c,o),n-=841.89,(s-=i)>0&&l.addPage();l.save("年度简报.pdf")}})},setChart:function(t){var e=echarts.init(document.getElementById(t.elmId)),a={backgroundColor:"white",legend:{data:[]},grid:{x:35,y:45,x2:35,y2:20,borderWidth:1},xAxis:{data:t.xData},yAxis:{name:t.name},series:[{name:t.name,type:"bar",data:t.data}]};e.setOption(a)}},created:function(){this.getData()},mounted:function(){}},c={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("ul",{staticClass:"tag"},[a("li",{class:{active:0==t.state},on:{click:function(e){t.selectTag(0)}}},[t._v("全部")]),t._v(" "),a("li",{class:{active:1==t.state},on:{click:function(e){t.selectTag(1)}}},[t._v("论文发表情况")]),t._v(" "),a("li",{class:{active:2==t.state},on:{click:function(e){t.selectTag(2)}}},[t._v("科研项目情况")]),t._v(" "),a("li",{class:{active:3==t.state},on:{click:function(e){t.selectTag(3)}}},[t._v("科研获奖情况")])]),t._v(" "),a("div",{staticClass:"tagNull"}),t._v(" "),a("div",{staticClass:"wrapper wrapper-content"},[a("div",{staticClass:"text-right"},[t.canExport?a("button",{staticClass:"btn btn-primary savePDF",on:{click:function(e){t.savePDF()}}},[t._v("生成PDF")]):t._e()]),t._v(" "),a("div",{staticClass:"ibox float-e-margins"},[t._m(0),t._v(" "),a("div",{staticClass:"ibox-content"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-sm-12 searchCondition"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.selectOption.length>0,expression:"selectOption.length > 0"}],staticClass:"searchOption"},[a("label",{staticClass:"control-label"},[t._v("统计模块")]),t._v(" "),a("select",{directives:[{name:"model",rawName:"v-model",value:t.model,expression:"model"}],staticClass:"form-control",on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.model=e.target.multiple?a:a[0]}}},[a("option",{domProps:{value:""}},[t._v("全部")]),t._v(" "),t._l(t.selectOption,function(e){return a("option",{domProps:{value:e}},[t._v(t._s(e))])})],2)])])]),t._v(" "),a("public-search",{attrs:{hideStatus:!0,pageName:"ndjb",condition:t.condition,searchOptions:t.searchOptions},on:{search:t.publicSearch}}),t._v(" "),a("div",{attrs:{id:"chartBox"}},[t._l(t.chartList,function(e,i){return[a("div",{directives:[{name:"show",rawName:"v-show",value:t.canShow(e),expression:"canShow(chart)"}],staticClass:"chart"},[a("div",{attrs:{id:e.elmId+"-box"}},[a("p",[t._v(t._s(e.title))]),t._v(" "),a("div",{staticStyle:{width:"600px",height:"400px"},attrs:{id:e.elmId}})])])]})],2)],1)])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"ibox-title"},[e("h5",[this._v("年度简报")])])}]};var o=a("VU/8")(n,c,!1,function(t){a("f+tP")},"data-v-18df8b80",null);e.default=o.exports},"f+tP":function(t,e){}});
//# sourceMappingURL=80.e7cdb6a5140ab42ba808.js.map